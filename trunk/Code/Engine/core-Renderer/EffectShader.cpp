#include "core-Renderer\EffectShader.h"
#include "core-Renderer\Renderer.h"
#include "core-Renderer\GeometryResource.h"
#include "core-Renderer\ShaderParam.h"
#include "core-Renderer\ShaderTexture.h"
#include "core.h"
#include <stdexcept>


///////////////////////////////////////////////////////////////////////////////

BEGIN_RESOURCE( EffectShader, tfx, AM_BINARY )
   PROPERTY( std::string, m_script )
END_RESOURCE()

///////////////////////////////////////////////////////////////////////////////

EffectShader::EffectShader(const FilePath& resourceName )
   : Resource( resourceName )
{
}

///////////////////////////////////////////////////////////////////////////////

EffectShader::~EffectShader() 
{
}

///////////////////////////////////////////////////////////////////////////////

void EffectShader::setScript( const std::string& script )
{
   m_script = script;
   setDirty();
}

///////////////////////////////////////////////////////////////////////////////

ShaderParam< EffectShader >* EffectShader::createTextureSetter( MemoryPoolAllocator& allocator, const IDString& paramName, ShaderTexture& val )
{
   return val.createEffectShaderTextureSetter( allocator, paramName );
}

///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////

RCBindEffect::RCBindEffect( EffectShader& shader, Renderer& renderer ) 
   : ShaderRenderCommand< EffectShader >( *renderer.getAllocator() )
   , m_shader( shader ) 
{
}

///////////////////////////////////////////////////////////////////////////////